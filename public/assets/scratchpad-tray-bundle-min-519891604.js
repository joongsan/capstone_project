(function(){window.Scratchpad=window.Scratchpad||{};if(window.Scratchpad.page){var c=window.Scratchpad.page;}if(window.Scratchpad.headerTray){var b=window.Scratchpad.headerTray;}if(window.Scratchpad.TrayItem){var a=window.Scratchpad.TrayItem;}window.Scratchpad={page:c||false,headerTray:b||{},trayItem:a||{},endpoints:{historyCount:"/api/userhistory/count",historyData:"/api/userhistory",viewership:"/Hotels/Offers?action=getHotelProductActivity&hotelIds=",regionViewership:"/api/urgency/regionActivity/",hotelPriceInfo:"/api/userhistory/pricing",sendMeNotes:"/sendmenotes",loginRedirect:"/user/login?ckoflag=0&hsuc=&fram=&uurl=qscr%3Dredr%26rurl%3D%2Fscratchpad%3FsendMeNotes%3Dtrue",scratchpadOptions:"/api/userhistory/options",addNotes:"/scratchpad/addnote",instaflights:"/api/userhistory/instaflights"},state:{isUsPos:false,isTVLY:false,isWotif:false,isLastMinute:false,isOrbitz:false,isCheapTickets:false,isEbookers:false,isHotwire:false,isAago:false,isMrJet:false,tuid:"",guid:"",expuserid:"",loggedInUser:false,guestUser:false,userIsNudgeEnrolled:false,legacyTemplates:false,blockSaveHeader:false,blockNotesHeader:false,browserVersion:null,supportedLOBs:-1,userPrompts:[],historyData:[],currentCount:-1,pricingRequestTimeout:window.pricingRequestTimeout||5000},init:function(){var t=this,l=this.signedInUserCheck(),h=this.getLOBs(),s=this.updateCountEndpoint(),i=this.browserVersionCheck(),o=this.handlebarsCheck(),p=this.tvlyCheck(),g=this.wotifCheck(),k=this.lastMinuteCheck(),q=this.orbitzCheck(),j=this.cheapTicketsCheck(),f=this.ebookersCheck(),d=this.hotwireCheck(),e=this.mrJetCheck(),m=this.aagoCheck(),r=this.usPosCheck(),n=$.Deferred().done(function(u){t.state.pageId=u;if(u=="Emain"){if(typeof addScratchpadBadge==="function"){addScratchpadBadge(true);}return;}if(!t.state.blockNotesHeader){t.state.blockNotesHeader=!t.state.isUsPos;}t.headerTray.init(t.state);t.getHistoryCount();t.trayTestAndLearns.init(t.state,u);if(window.AlertsMenu){AlertsMenu.tests.init();}});this.pageIdCheck(n);this.manageAlertMenu();return{signedInUserCheck:l,supportedLOBs:h,updateCountEndpoint:s,handlebarsCheck:o,browserVersionCheck:i,usPosCheck:r,tvlyCheck:p,wotifCheck:g,lastMinuteCheck:k,orbitzCheck:q,cheapTicketsCheck:j,ebookersCheck:f,hotwireCheck:d,mrJetCheck:e,aagoCheck:m};},usPosCheck:function(){var d=$(".site-header-primary").hasClass("us-pos");this.state.isUsPos=d;return d;},tvlyCheck:function(){var d=/travelocity/.test(window.location.href);this.state.isTVLY=d;return d;},wotifCheck:function(){var d=/wotif/.test(window.location.href);this.state.isWotif=d;return d;},lastMinuteCheck:function(){var d=/lastminute/.test(window.location.href);this.state.isLastMinute=d;return d;},orbitzCheck:function(){var d=/orbitz/.test(window.location.href);this.state.isOrbitz=d;return d;},cheapTicketsCheck:function(){var d=/cheaptickets/.test(window.location.href);this.state.isCheapTickets=d;return d;},ebookersCheck:function(){var d=/ebookers/.test(window.location.href);this.state.isEbookers=d;return d;},mrJetCheck:function(){var d=/mrjet/.test(window.location.href);this.state.isMrJet=d;return d;},hotwireCheck:function(){var d=/hotwire/.test(window.location.href);this.state.isHotwire=d;return d;},aagoCheck:function(){var d=/airasiago/.test(window.location.href);this.state.isAago=d;return d;},pageIdCheck:function(f){if(/pub\/agent\.dll/i.test(window.location.href)){f.resolve("Emain");return;}var e=0;var d=setInterval(function(){var h=$("#pageId");if(h.attr("value")){clearInterval(d);var g=h.attr("value").split(".");if((g[1]==="Hotels"||g[1]==="Packages")||g[1]==="car"&&g[2]){g=g[1]+"-"+g[2];}else{if(/Flight-Search/i.test(g[1])){g="Flight-Search";}else{if(g[1]){g=g[1];}else{g=g[0];}}}f.resolve(g);}else{if(e>100){clearInterval(d);f.resolve("Page Id did not arrive in time");}}e+=5;},5);},getLOBs:function(){var d=$("#scratchpad-badge-lobs").attr("data-id");if(!d||d==="null"){this.state.supportedLOBs=-1;}else{d=d.split(",");this.state.supportedLOBs=d;}return this.state.supportedLOBs;},buildLOBsQueryParam:function(f){f=f||"&";var g=f,d=this.state.supportedLOBs.length||0,e=0;if(this.state.supportedLOBs===-1||d===0){g="";}else{for(e=0;e<d;e++){g=g+("&lobs="+this.state.supportedLOBs[e]);}if(g.charAt(0)=="&"){g=g.slice(1);}}return g;},updateCountEndpoint:function(){var h="tuid=",f=$("#scratchpad-badge-tuid").attr("data-id"),j=$("#scratchpad-badge-guid").attr("data-id"),g=$("#scratchpad-badge-expuserid").attr("data-id"),l=this.buildLOBsQueryParam("&"),d=($("#scratchpad-badge-site-id").attr("data-id")||1),e=$("#scratchpad-badge-url").attr("data-id"),m="",k=false,n=[],i="";this.state.guid=j;this.state.tuid=f;this.state.expuserid=g;if(parseInt(f,10)===-1||f===""){i=j;h="guid=";n.push("GUID");}else{i=f;n.push("TUID");}if(!i||!e){n="Either userId or url is invalid";}else{e+="/userHistory/count/jsonp?";m=e+h+i+"&expuserid="+g+"&siteid="+d+l+"&format=jsonp&callback=?";this.endpoints.historyCount=m;if(n.push){n.push(m);}k=true;}return{pass:k,result:n};},signedInUserCheck:function(){var i=$("#header-history"),e=$(".shop-nav").hasClass("signed-in"),d=[e],h=false,g,f;if(/hotwire/.test(window.location.href)){e=$(".account-menu").hasClass("signed-in");}if(i.attr("data-identifieduser")){f=(i.attr("data-identifieduser")=="true");d.push(f);}else{d="userStateFlag is missing or lacks required attributes";}if(i.attr("data-guestuser")){g=(i.attr("data-guestuser")=="true");if(d.push){d.push(g);}}else{d="guestUserFlag is missing or lacks required attributes";}this.state.loggedInUser=(e||f);this.state.guestUser=g;h=(typeof d!="string");return{pass:h,result:d};},handlebarsCheck:function(){var f=(this.state.browserVersion=="Firefox 41");var e=($("#scratchpad-badge-site-id").attr("data-id")||1);var d=(!!window.Handlebars&&!!window.uitk&&!f&&(e!=80004)&&uitk.version.split(".")[0]==="v2");this.state.legacyTemplates=!d;return{pass:true,result:d};},browserVersionCheck:function(){var e=navigator.userAgent,d,f=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(f[1])){d=/\brv[ :]+(\d+)/g.exec(e)||[];return"IE "+(d[1]||"");}if(f[1]==="Chrome"){d=e.match(/\b(OPR|Edge)\/(\d+)/);if(d!=null){return d.slice(1).join(" ").replace("OPR","Opera");}}f=f[2]?[f[1],f[2]]:[navigator.appName,navigator.appVersion,"-?"];if((d=e.match(/version\/(\d+)/i))!=null){f.splice(1,1,d[1]);}this.state.browserVersion=f.join(" ");return f.join(" ");},manageAlertMenu:function(){if(window.AlertsMenu){AlertsMenu.init();}return this;},unpackUserHistoryResponse:function(e){this.state.userIsNudgeEnrolled=e.sendNotes;this.determineAdditionalUserMessaging(e);this.headerTray.handleUserHistoryCheck(e,true);if(!e.userHistory.length||e.userHistory.length<=0){return;}if(this.state.historyData.length===0){this.state.historyData=e.userHistory;this.trayTestAndLearns.lateAddItemTL(this.state.pageId);}else{if(this.trayTestAndLearns.state.requestLateHistory&&e.userHistory.length===1){var d=true;for(var f=0;f<this.state.historyData.length;f++){if(this._modelsMatch(e.userHistory[0],this.state.historyData[f])){this.state.historyData[f]=e.userHistory[0];d=false;}}if(d){this.state.historyData.unshift(e.userHistory[0]);this.state.currentCount++;}}else{this.state.historyData=e.userHistory;}}this.getHotelViews();this.getRegionViews();return this;},determineAdditionalUserMessaging:function(h){var e={},j=(this.state.isUsPos&&h.anyNews&&!window.AlertsMenu),d=!this.state.blockSaveHeader&&(!this.state.loggedInUser||this.state.guestUser),g=!this.state.blockNotesHeader&&this.state.isUsPos&&!j&&!h.sendNotes,i=(this.state.currentCount<1);if(g){e.promptType="notes";}else{if(d){e.promptType="save";}else{if(i){e.promptType="default";}}}if(e.promptType&&e.promptType!=="default"){if(window.AlertsMenu){var f={news:"spBasicNews",notes:"spNudgeEnroll",save:"spSignIn"}[e.promptType];AlertsMenu.addLateAlert({newsFeedType:"scratchpadLegacyAlert",msgid:f,params:[]});}else{this.state.userPrompts.push(e);}}else{if(e.promptType){this.state.userPrompts.push(e);}}this.headerTray.showTooltips();
return this;},determineAdditionalUserMessagingFromOptions:function(h){if(h&&h.status=="SUCCESS"&&h.scratchpadUserOptions){var d={},i=this.getLocalFlag("scratchpadDeclineNotesInTray"),e=this.getLocalFlag("scratchpadDeclineSaveInTray"),g=(!this.state.loggedInUser||this.state.guestUser)&&!e,l=(this.state.currentCount<1),j=this.state.isUsPos&&h.scratchpadUserOptions.anyNews&&!window.AlertsMenu,f=!i&&this.state.isUsPos&&!j&&!h.scratchpadUserOptions.sendNotes;if(f){d.promptType="notes";}else{if(g){d.promptType="save";}else{if(l){d.promptType="default";}}}if(d.promptType&&d.promptType!=="default"){if(window.AlertsMenu){var k={news:"spBasicNews",notes:"spNudgeEnroll",save:"spSignIn"}[d.promptType];AlertsMenu.addLateAlert({newsFeedType:"scratchpadLegacyAlert",msgid:k,params:[]});}else{this.state.userPrompts.push(d);}}else{if(d.promptType){this.state.userPrompts.push(d);}}}this.headerTray.showTooltips();return this;},enrollInNudge:function(){var d=this;this.state.blockNotesHeader=true;if(this.page){this.page.setNotesToggle(true);}return this.sendNotes(true);},declineNudge:function(d){this.state.blockNotesHeader=true;if(!d){this.sendeVar28("Scratchpad.NotesLater").setLocalFlag("scratchpadDeclineNotesInTray",true);}return this.sendNotes(false);},declineSignInToSave:function(){this.state.blockSaveHeader=true;this.sendeVar28("Scratchpad.SaveLater").setLocalFlag("scratchpadDeclineSaveInTray",true);return this;},updateBadgeCount:function(d){d=parseInt(d);if(!d||isNaN(d)){d=0;}d=Math.min(d,30);this.state.currentCount=d;this.headerTray.state.currentCount=d;this.trayTestAndLearns.state.currentCount=d;return this;},getHistoryCount:function(){var e=this;var d=(this.endpoints.historyCount=="/api/userhistory/count")?"json":"jsonp";var f=(Scratchpad.state.pageId=="Hotel-Search")?20000:5000;this._request(this.endpoints.historyCount,d,"GET",{},f).then(function(g){if((g.responsestatus&&g.responsestatus.status&&g.responsestatus.status=="SUCCESS")||(g.status&&g.status=="SUCCESS")){g.count=g.count||0;e.updateBadgeCount(g.count);e.headerTray.state.isOkToShowTray=true;if(g.count>0){e.getHistoryData(Math.min(g.count,5),true);}else{e.getUserFlags().then(function(){e.headerTray.updateUI();Scratchpad.headerTray.showEmptyListState();e.trayTestAndLearns.lateAddItemTL(e.state.pageId);});}}else{e.getHistoryData(0,true);}}).fail(function(){e.getHistoryData(0,true);});return{pass:true,result:[]};},getHistoryData:function(d,g){var e=this,f=this.endpoints.historyData;lobs=this.buildLOBsQueryParam("&");f+=("?l="+d);f+=lobs;this._request(f).then(function(i){if(i&&i.status=="SUCCESS"&&i.userHistory){var j=i.userHistory.length,h=e.state.currentCount;if(j>0&&h==-1){e.updateBadgeCount(i.userHistory.length);}if(j==0&&h==-1){Scratchpad.headerTray.showEmptyListState();}e.headerTray.state.isOkToShowTray=true;e.unpackUserHistoryResponse(i);}else{e.headerTray.state.isOkToShowTray=false;Scratchpad.headerTray.showEmptyListState();}}).fail(function(){e.headerTray.state.isOkToShowTray=false;Scratchpad.headerTray.showEmptyListState();});return{pass:true,result:[]};},getUserFlags:function(){var d=this;return this._request(this.endpoints.scratchpadOptions).then(function(e){d.determineAdditionalUserMessagingFromOptions(e);});},getHotelViews:function(d){var f=this,e="",j="",h;if(d){e=d;}else{for(var g=0;g<this.headerTray.trayItems.length;g++){h=this.headerTray.trayItems[g];if(h.type==="hotel"){e+=h.get("hotelId")+",";}else{continue;}}}e=e.replace(/,$/,"");if(e!==""){j=this.endpoints.viewership+e+"&durationForViews=1800000&durationForBookings=172800000";Scratchpad._request(j).then(function(i){if(i&&i.HotelProductActivityList){f.headerTray.handleHotelViewershipResponse(i);}});}return{pass:true,result:j};},getRegionViews:function(){var d=this,f,g;for(var e=0;e<this.headerTray.trayItems.length;e++){f=this.headerTray.trayItems[e];if(f.type!=="hotelSearch"){return;}g=this.endpoints.regionViewership+f.get("searchRegionId");Scratchpad._request(g).then(function(h){if(h&&h.hotelProductActivityAtRegionLevelList){d.headerTray.handleRegionViewershipResponse(h);}});}},getHotelPricing:function(f,g){var d=this,e={hotels:f.idArray,checkInDateString:f.startDate,checkOutDateString:f.endDate,roomOccupants:g};return $.ajax({url:this.endpoints.hotelPriceInfo,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(e),timeout:d.state.pricingRequestTimeout});},getInstaFlights:function(d){return $.ajax({url:this.endpoints.instaflights,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(d),timeout:5000});},sendNotes:function(d){return this._request(this.endpoints.sendMeNotes,"json","POST",{sendMeNotes:d}).done(function(e){if(d&&!e){window.location.href=Scratchpad.endpoints.loginRedirect;}});},logeVar34:function(d){return this;},sendeVar28:function(d){if(window.dctk&&window.dctk.onReady){dctk.onReady(function(){dctk.omtr.eVar28=d;dctk.omtr.events="event80";dctk.omtr.linkTrackVars="eVar28,events";dctk.omtr.linkTrackEvents="event80,event81";dctk.omtr.tl(true,"o","RFRR Action Link");});}return this;},sendeVar34WithoutChecks:function(d){dctk.omtr.eVar34=d;dctk.omtr.events="event80";dctk.omtr.linkTrackVars="eVar34,events";dctk.omtr.linkTrackEvents="event80,event81";dctk.omtr.tl(true,"o","RFRR Action Link");},sendeVar34:function(d){if(window.dctk&&window.dctk.onReady){dctk.onReady(function(){Scratchpad.sendeVar34WithoutChecks(d);});}return this;},sendeVar34WithDelay:function(d){if(window.dctk&&window.dctk.onReady){dctk.onReady(function(){setTimeout(function(){Scratchpad.sendeVar34WithoutChecks(d);},500);});}return this;},addHistoryItemNote:function(d,e){return this._request(this.endpoints.addNotes,"json","POST",{uid:e,note:d});},_request:function(h,d,e,g,f){if(!h){return;}return $.ajax({url:h,type:e||"GET",dataType:d||"json",data:g||{},cache:false,timeout:f||5000});},_requestWithObj:function(d){return $.ajax(d);},publishEvent:function(d){if(!window.uitk||!window.uitk.publish){return false;}uitk.publish(d);return true;},setLocalFlag:function(d,f){try{if(window.localStorage){try{window.localStorage.setItem(d,f);}catch(g){return false;}}}catch(g){return false;}return true;},getLocalFlag:function(d){var g=false;try{if(window.localStorage){try{g=window.localStorage.getItem(d);}catch(f){return false;}}}catch(f){return false;}return g;},decodeHtmlEntity:function(d){return d.replace(/&#(\d+);/g,function(f,e){return String.fromCharCode(e).replace("(","").replace(")","").replace("[","").replace("]","").replace("{","").replace("}","").replace("<","").replace(">","").replace("=","");});},encodeHtmlEntity:function(e){var d=[],e=e.replace(/[<>]+/g,""),f=(e.length-1);for(f;f>=0;f--){d.unshift(["&#",e[f].charCodeAt(),";"].join(""));}return d.join("");},_modelsMatch:function(f,e){if(f.hasOwnProperty("product")&&e.hasOwnProperty("product")&&(f.product===e.product)&&(f.type===e.type)){var d={"AIR":"flight","HOTEL":((f.type==="DETAIL")?"hotel":"hotelSearch"),"PACKAGE":"packages","CAR":((f.type==="DETAIL")?"carDetail":"carSearch"),"CRUISE":"cruise-search","ACTIVITY":"activity"}[f.product];if(f[d]["id"]===e[d]["id"]){return true;}else{return false;}}else{return false;}}};if(window.define){define("scratchpad",["uitk","jquery"],function(){return Scratchpad;});}})();window.scratchpadInterventionAllowed=(function(){return false;})();window.scratchpadNewsUpdateNeeded=(function(){return false;})();window.logScratchpadIntervention=function(a){return"this method has been deprecated";};(function(){window.Scratchpad=window.Scratchpad||{};window.Scratchpad.TrayItem=function(e){var g="";var n=Scratchpad.headerTray.locStrings;this.trayIndex=e.trayIndex||null;if(!e.product){return;}if(e.product=="HOTEL"&&e.type==="DETAIL"){this.type="hotel";this.attributes=e.hotel;if(!this.get("price")){this.set("price","");this.set("lastSeenDate",n.seePrice);}else{var j=n[this.localizedAsOfKey()].replace("####",this.get("lastSeenDate"));this.set("lastSeenDate",j);}g=/\?/.test(this.get("deepLinkUrl"))?"&":"?";this.set("rfrrString",(g+"rfrr=SP.Tray."+this.trayIndex+"."+"HI"));
this.set("deepLinkUrl",(this.get("deepLinkUrl")+this.get("rfrrString")));if(this.get("thumbnailUrl")){var i="//images.trvl-media.com";this.set("thumbnailUrl",i.concat(this.get("thumbnailUrl").replace("_s","_t")));}this.template=Scratchpad.headerTray.templates.hotelTemplate;this.$el=$($.trim(this.template(this.attributes)));if(!this.get("checkInDate")||!this.get("checkOutDate")){this.$el.addClass("dateless");}else{if(this.get("price")===""){this.$el.addClass("priceless");}}}else{if(e.product=="HOTEL"&&e.type==="SEARCH"){this.type="hotelSearch";this.attributes=e.hotelSearch;this.set("viewCount",0);if(this.get("lastSeenDate")){var d=n[this.localizedAsOfKey()].replace("####",this.get("lastSeenDate"));this.set("lastSeenDate",d);}g=/\?/.test(this.get("deepLinkUrl"))?"&":"?";this.set("rfrrString",(g+"rfrr=SP.Tray."+this.trayIndex+"."+"HS"));this.set("deepLinkUrl",(this.get("deepLinkUrl")+this.get("rfrrString")));if(this.get("thumbnailUrl")){this.set("thumbnailUrl",(this.get("thumbnailUrl").replace("_s","_t")));}this.template=Scratchpad.headerTray.templates.hotelSearchTemplate;this.$el=$($.trim(this.template(this.attributes)));}else{if(e.product=="AIR"&&e.type==="SEARCH"){this.type="flight";this.attributes=e.flight;var b=Scratchpad.headerTray.locStrings.fromTo;b=b.replace("####",this.get("departureAirportCode"));b=b.replace("####",this.get("arrivalAirportCode"));this.set("airportToAirport",b);if(!this.get("price")){this.set("price","");this.set("lastSeen","See price");}else{var h=n.from.replace("####",this.get("price"));var d=n[this.localizedAsOfKey()].replace("####",this.get("lastSeen"));this.set("price",h);this.set("lastSeen",d);}g=/\?/.test(this.attributes.deepLinkUrl)?"&":"?";if(this.get("returnDate")){this.set("returnDate",(" - "+this.get("returnDate")));}else{this.set("returnDate","");}this.set("rfrrString",(g+"rfrr=SP.Tray."+this.trayIndex+"."+"FS"));this.set("deepLinkUrl",(this.get("deepLinkUrl")+this.get("rfrrString")));if(this.get("routeType")){var c=this.get("routeType").replace("ROUND_TRIP",Scratchpad.headerTray.locStrings.roundTrip).replace("ONE_WAY",Scratchpad.headerTray.locStrings.oneWay);this.set("routeType",c);}this.template=Scratchpad.headerTray.templates.flightTemplate;this.$el=$($.trim(this.template(this.attributes)));if(!this.get("departureDate")){this.$el.addClass("dateless");}else{if(this.get("price")===""){this.$el.addClass("priceless");}}}else{if(e.product=="PACKAGE"){this.type="package";this.attributes=e.packages;if(!this.get("price")){this.set("price","");this.set("lastSeen","See price");}else{var h=n.from.replace("####",this.get("price"));var d=n[this.localizedAsOfKey()].replace("####",this.get("lastSeen"));this.set("price",h);this.set("lastSeen",d);}if(this.get("returnDate")){this.set("returnDate",(" - "+this.get("returnDate")));}else{this.set("returnDate","");}g=/\?/.test(this.attributes.deepLinkUrl)?"&":"?";this.set("rfrrString",(g+"rfrr=SP.Tray."+this.trayIndex+"."+"PS"));this.set("deepLinkUrl",(this.get("deepLinkUrl")+this.get("rfrrString")));this.template=Scratchpad.headerTray.templates.packageTemplate;this.$el=$($.trim(this.template(this.attributes)));}else{if(e.product=="AIR"&&e.type==="DETAIL"){this.type="flightDetail";this.attributes=e.flightDetail;if(!this.get("formattedPricePerPerson")){this.set("formattedPricePerPerson","");this.set("lastSeen","See price");}else{this.set("price",this.get("formattedPricePerPerson"));var d=n[this.localizedAsOfKey()].replace("####",this.get("lastSeenDate"));this.set("lastSeen",d);}g=/\?/.test(this.attributes.url)?"&":"?";this.set("rfrrString",(g+"rfrr=SP.Tray."+this.trayIndex+"."+"FD"));this.set("deepLinkUrl",(this.get("url")+this.get("rfrrString")));var m="//images.trvl-media.com/media/content/expus/graphics/static_content/fusion/v0.1b/images/airlines";var l=m+"/vector/s/";var k=m+"/s/";this.attributes.legs.forEach(function(p){if(p.airlineImageFileName){p.finalImagePath=l+p.airlineImageFileName+"_sq.svg";p.fallbackImagePath=k+p.airlineImageFileName+"_sq.jpg";}else{p.finalImagePath=l+"multiple_airlines_logo_sq.svg";p.fallbackImagePath=k+"multiple_airlines_logo_sq.jpg";}if(p.airlineImageFileName){p.altText=p.airlineName+n["airlineLogoAltText"];}else{p.altText=n["multipleAirlinesLogoAltText"];}});this.template=Scratchpad.headerTray.templates.flightDetailTemplate;this.$el=$($.trim(this.template(this.attributes)));}else{if(e.product=="CAR"&&e.type==="SEARCH"){this.type="carSearch";this.attributes=e.carSearch;if(this.get("pickupRegionType")=="AIRPORT"){this.set("txtPreLocation",n.carsAt.replace("####",this.get("pickupLocation")));}else{this.set("txtPreLocation",n.carsNear.replace("####",this.get("pickupLocation")));}if(!this.get("price")){this.set("price","");this.set("lastSeen","See price");}else{var h=n.from.replace("####",this.get("price"));this.set("price",h);var d=n[this.localizedAsOfKey()].replace("####",this.get("lastSeenDate"));this.set("lastSeen",d);}g=/\?/.test(this.attributes.deepLink)?"&":"?";this.set("rfrrString",(g+"rfrr=SP.Tray."+this.trayIndex+"."+"CS"));this.set("deepLink",(this.get("deepLink")+this.get("rfrrString")));this.template=Scratchpad.headerTray.templates.carSearchTemplate;this.$el=$($.trim(this.template(this.attributes)));}else{if(e.product=="CAR"&&e.type==="DETAIL"){this.type="carDetail";this.attributes=e.carDetail;this.set("txtPreLocation",this.get("pickupLocation"));if(!this.get("price")){this.set("price","");this.set("lastSeen","See price");}else{var h=n.from.replace("####",this.get("price"));this.set("price",h);var d=n[this.localizedAsOfKey()].replace("####",this.get("lastSeenDate"));this.set("lastSeen",d);}g=/\?/.test(this.attributes.deepLink)?"&":"?";this.set("rfrrString",(g+"rfrr=SP.Tray."+this.trayIndex+"."+"CD"));this.set("deepLink",(this.get("deepLink")+this.get("rfrrString")));var f="//images.trvl-media.com/cars";this.set("thumbnailUrl",f+this.get("thumbnailUrl"));this.template=Scratchpad.headerTray.templates.carDetailTemplate;this.$el=$($.trim(this.template(this.attributes)));}else{if(e.product=="CRUISE"&&e.type==="SEARCH"){this.type="cruiseSearch";this.attributes=e.cruiseSearch;if(this.get("destination")){this.set("destination",this.get("destination"));}else{this.set("destination",n.allDestinations);}if(this.get("departureDate")){this.set("departureDate",this.get("departureDate"));}else{this.set("departureDate",n.allMonths);}if(!this.get("price")){this.set("price","");this.set("lastSeen","See price");}else{this.set("price",this.get("price"));var d=n[this.localizedAsOfKey()].replace("####",this.get("lastSeenDate"));this.set("lastSeen",d);}g=/\?/.test(this.attributes.deepLink)?"&":"?";this.set("rfrrString",(g+"rfrr=SP.Tray."+this.trayIndex+"."+"CRC"));this.set("deepLink",(this.get("deepLink")+this.get("rfrrString")));this.template=Scratchpad.headerTray.templates.cruiseSearchTemplate;this.$el=$($.trim(this.template(this.attributes)));}else{if(e.product=="ACTIVITY"&&e.type==="SEARCH"){this.type="activitySearch";this.attributes=e.activitySearch;var o=this.get("destination");if(o&&o.length>1){var a=o.charAt(0).toUpperCase()+o.substr(1);}else{var a=o;}this.set("destination",a);this.set("startDate",this.get("startDate"));this.set("endDate",this.get("endDate"));if(!this.get("price")){this.set("price","");this.set("lastSeenDate","See price");}else{this.set("price",this.get("price"));var d=n[this.localizedAsOfKey()].replace("####",this.get("lastSeenDate"));this.set("lastSeenDate",d);}g=/\?/.test(this.attributes.deepLink)?"&":"?";this.set("rfrrString",(g+"rfrr=SP.Tray."+this.trayIndex+"."+"ACS"));this.set("deepLink",(this.get("deepLink")+this.get("rfrrString")));this.template=Scratchpad.headerTray.templates.activitySearchTemplate;this.$el=$($.trim(this.template(this.attributes)));}else{if(e.product=="ACTIVITY"&&e.type==="DETAIL"){this.type="activityDetail";this.attributes=e.activityDetail;this.set("destination",this.get("title"));this.set("startDate",this.get("startDate"));this.set("endDate",this.get("endDate"));this.set("activityTimeAltText",n["duration"]);if(!this.get("price")){this.set("price","");
this.set("lastSeenDate","See price");}else{this.set("price",this.get("price"));var d=n[this.localizedAsOfKey()].replace("####",this.get("lastSeenDate"));this.set("lastSeenDate",d);}g=/\?/.test(this.attributes.deepLink)?"&":"?";this.set("rfrrString",(g+"rfrr=SP.Tray."+this.trayIndex+"."+"ACD"));this.set("deepLink",(this.get("deepLink")+this.get("rfrrString")));if(this.get("thumbnail")){this.set("thumbnailUrl",(this.get("thumbnail")));}if(this.get("duration")){this.set("duration",(this.get("duration")));}this.template=Scratchpad.headerTray.templates.activityDetailTemplate;this.$el=$($.trim(this.template(this.attributes)));}}}}}}}}}}if(this.trayIndex===1){this.$el.addClass("first");}};window.Scratchpad.TrayItem.prototype={set:function(a,c,b){var d=false;if(this.attributes[a]&&this.attributes[a]===c){return;}else{this.attributes[a]=c;if(b){this.updateDisplay();}}},get:function(a){var b=null;if(this.attributes[a]){b=this.attributes[a];}return b;},localizedAsOfKey:function(){if(this.get("dateTimeFormatType")==="SHORT_TIME"){return"asOfTime";}else{return"asOfDate";}},insertBefore:function(a){this.$el.insertBefore(a);},removeFromTray:function(){this.$el.remove();},moveToIndex:function(a){this.trayIndex=a;},updateDisplay:function(){var a=$($.trim(this.template(this.attributes))).find(".item-link");this.$el.empty().html(a);}};})();var Scratchpad=Scratchpad||{};(function(a){a.headerTray={$elements:{$history:null,$badge:null,$greeting:null,$viewAllItem:null},templates:{hotelTemplate:null,hotelSearchTemplate:null,flightTemplate:null,flightDetailTemplate:null,packageTemplate:null,carSearchTemplate:null,carDetailTemplate:null,cruiseSearchTemplate:null,activitySearchTemplate:null,activityDetailTemplate:null},state:{isTVLY:false,isWotif:false,isAago:false,greeting:false,blockSaveHeader:false,blockNotesHeader:false,userIsNudgeEnrolled:false,apiAttemptsRemaining:0,currentCount:-1,historyData:[],isOkToShowTray:false,trayIsTurnedOn:false,addSearchAsItem:false,userHasNews:false,alreadyShowedTT:false},locStrings:{scratchpadName:"Scratchpad",seePrice:"See price",asOf:"as of ####",from:"from ####",oneWay:"One way",roundTrip:"Round trip",fromTo:"#### to ####",others:"#### others viewing now",other:"1 other viewing now",plus:"#### + ####",included:"#### and #### included",notesConfirmation:"We'll send Scratchpad updates to you by email. Watch your inbox!",defaultHeaderMessage:"Things you view while shopping are saved here. Pick up where you left off.",getUpdates:"Get Scratchpad updates by email.",thingsSavedHere:"Things you view while shopping are saved here.",viewScratchpad:"View Scratchpad",viewAllItems:"View all #### items",searchIsSaved:"This search has been saved in your Scratchpad.",sendNotesTo:"We'll send updates to ####. Watch your inbox!",pageGetUpdates:"Get updates about things in your Scratchpad.",notAvailable:"Not available",findOutWhy:"Find out why",room:"1 room left at this price",rooms:"#### rooms left at this price",packages:"#### Packages",flight:"Flight",hotel:"hotel",car:"car",othersSearching:"#### others searching now",hotels:"#### Hotels",fromToHyphen:"#### - ####",hotelSearchAvgPerNight:"avg per night",perPerson:"per person",airlineLogoAltText:"logo",multipleAirlinesLogoAltText:"Multiple Airlines logo"},trayItems:[],productNameMap:{"FLIGHT":"Flight","HOTEL":"hotel","CAR":"car","CRUISE":"cruise","ACTIVITY":"activity"},init:function(c){for(var b in c){if(c.hasOwnProperty(b)){this.state[b]=c[b];}}this.locStrings=window.scratchpadLocStrings||this.locStrings;this.productNameMap={"FLIGHT":this.locStrings.flight,"HOTEL":this.locStrings.hotel,"CAR":this.locStrings.car};this.captureElements();this.themeCheck();this.captureTemplates();this.bindHeaderButtons();this.nuxScratchpadPopup();if(this.state.isUsPos){window.scratchpadPrivateDealsEnabled=window.scratchpadPrivateDealsEnabled||false;}},nuxScratchpadPopup:function(){if(uitk&&uitk.version.split(".")[0]==="v2"){if(this.nuxsessionStorage=="undefined"||this.nuxsessionStorage==null){this.nuxsessionStorage=uitk.createBrowserStorage("local");}if(this.nuxsessionStorage.readItem("nuxScratchpadShow")==null){this.nuxsessionStorage.saveItem("nuxScratchpadShow","false");this.$elements.$history.trigger("scratchpad.turnedOn");}}},captureElements:function(){var c=true,b="success";this.$elements.$history=$("#header-history.nav-tab");this.$elements.$badge=$("#scratchpad-badge");this.$elements.$greeting=$(".scratchpad-greeting");this.$elements.$viewAllItem=$(".view-all-history");if(!this.$elements.$history||!this.$elements.$badge||!this.$elements.$greeting||!this.$elements.$viewAllItem){c=false;b="not all elements were captured";}return{pass:c,result:[b]};},themeCheck:function(){var b=parseInt(window.scrachpadWhiteTrayTheme,10);this.state.themeBucket=b;return b;},updateUI:function(){if(!window.AlertsMenu){this.updateTrayHeader();}this.updateBadge();this.updateTrayFooter();this.updateNavAction();},updateBadge:function(c){c=c||this.state.currentCount;var b=c>0;this.$elements.$badge.text(c).toggleClass("badge-urgent",b).toggleClass("visuallyhidden",!b);if(!b){$("#accessibleTrayBadge").attr("aria-hidden","true");}else{$("#accessibleTrayBadge").attr("aria-hidden","false").html((c==1)?accessibleTrayBadgeOne:accessibleTrayBadgePlural.replace("####",c));}return{pass:true,result:[c,b]};},updateNavAction:function(){if(this.state.isOkToShowTray&&!this.state.trayIsTurnedOn){var b=this;this.state.trayIsTurnedOn=true;if(this.state.isTVLY){this.$elements.$history.parent().addClass("isTVLY");}if(this.state.isWotif){this.$elements.$history.parent().addClass("isWotif");}if(this.state.isLastMinute){this.$elements.$history.parent().addClass("isLastMinute");}if(this.state.isOrbitz){this.$elements.$history.parent().addClass("isOrbitz");}if(this.state.isCheapTickets){this.$elements.$history.parent().addClass("isCheapTickets");}if(this.state.isEbookers){this.$elements.$history.parent().addClass("isEbookers");}if(this.state.isAago){this.$elements.$history.parent().addClass("isAago");}if(this.state.isMrJet){this.$elements.$history.parent().addClass("isMrJet");}if(this.state.isHotwire){this.$elements.$history.addClass("menu-control").parent().addClass("isHotwire");}if(!this.state.isHotwire){$("<span>").addClass("icon icon-toggle180").attr("aria-hidden","true").appendTo(this.$elements.$history);}this.$elements.$history.attr("data-control","menu").attr("href","#").trigger("scratchpad.turnedOn").click(function(){$(".user-history-tab").uitk_tooltip("hide");b.state.alreadyShowedTT=true;});}return{pass:true,result:[this.state.trayIsTurnedOn]};},becomeTwoColumn:function(){$(".user-history-tab .menu").addClass("two-column");return this;},showTooltips:function(){if(this.state.alreadyShowedTT){return;}this.filterTooltipsBecauseUITKIsNotWorking(Scratchpad.state.pageId,Scratchpad.state.isTVLY);if(!Scratchpad.trayTestAndLearns.state.isMobileHeader){if(Scratchpad.state.pageId==="Hotels-Infosite"){this.updateScratchpadLink();this.showHotelInfositeTooltip();}else{if(Scratchpad.state.pageId==="Flight-Search"&&!window.scratchpadBlockFSRTooltip){this.updateScratchpadLink();Scratchpad.trayTestAndLearns.searchTooltipTL();}else{if(Scratchpad.state.pageId==="car-search"&&Scratchpad.state.historyData.length){this.updateScratchpadLink();Scratchpad.trayTestAndLearns.searchTooltipTL();}else{if(Scratchpad.state.pageId==="Flight"&&$(".user-history-tab").hasClass("udpTT")){this.updateScratchpadLink();Scratchpad.trayTestAndLearns.flightTooltipTL();}}}}}return this;},filterTooltipsBecauseUITKIsNotWorking:function(c,f){var b=$(".user-history-tab").attr("data-content");if(this.state.alreadyFilteredTTString){return;}var g=b.split("</div>");var e=Scratchpad.state.userIsNudgeEnrolled;var d="";if(f){if(c==="Hotels-Infosite"){d=g[0]+"</div>";}else{if(c==="Flight-Search"||c==="car-search"){d=g[1]+"</div>";}else{if(c==="Flight"){d=g[2]+"</div>";}}}}else{if(c==="Hotels-Infosite"){if(e){d=g[0]+"</div>";}else{d=g[3]+"</div>";}}else{if(c==="Flight-Search"||c==="car-search"){if(e){d=g[1]+"</div>";}else{d=g[4]+"</div>";
}}else{if(c==="Flight"){if(e){d=g[2]+"</div>";}else{d=g[5]+"</div>";}}}}}$(".user-history-tab").attr("data-content",d);this.state.alreadyFilteredTTString=true;if(!f){$(".user-history-tab").attr("nudge-data",g[g.length-2]+"</div>");}},updateScratchpadLink:function(){var b=$(".user-history-tab").attr("data-content");var d=$.parseHTML(b);var c=$(d).find("span:first").text();$("#header-history").append('<span class="visuallyhidden">'+c+" </span>");},showHotelInfositeTooltip:function(c){var b=this;require(["infosite"],function(h){if(!window.uitk||h.isDateless||b.state.alreadyShowedTT){return false;}b.state.alreadyShowedTT=true;var f=$(".user-history-tab"),i=Scratchpad.state.userIsNudgeEnrolled,d=(!i&&f.attr("data-tt-color")==="blue"),e=f.attr("data-content");f.attr("data-content","");f.uitk_tooltip("show");$(".theme-urgency .tooltip-inner").html(e);$(".hotel-saved-cta").after($(".user-history-tab").attr("nudge-data"));var g=$(".theme-urgency").addClass((d)?"isBlue":"").addClass((b.state.isTVLY)?"isTVLY":"").addClass((b.state.isWotif)?"isWotif":"").addClass((b.state.isLastMinute)?"isLastMinute":"").addClass((b.state.isOrbitz)?"isOrbitz":"").addClass((b.state.isCheapTickets)?"isCheapTickets":"").addClass((b.state.isHotwire)?"isHotwire":"").addClass((b.state.isAago)?"isAago":"").addClass((b.state.isEbookers)?"isEbookers":"").addClass((b.state.isMrJet)?"isMrJet":"");g.find(".sp-enrollment-tt-cta").click(function(){Scratchpad.sendeVar28("SP.HSRTooltip.CTA").enrollInNudge();if(Scratchpad.state.loggedInUser){g.find(".hotel-saved-default, .hotel-saved-cta").hide();g.find(".enroll-success").show();uitk.utils.liveAnnounce(g.find(".enroll-success").text(),"polite");}});if(g.hasClass("top")){g.css({"top":"150px"}).removeClass("top").addClass("bottom");}if(i){g.find(".hotel-saved-default").show();}else{g.find(".hotel-saved-cta").show();}if(Scratchpad.state.isTVLY){g.find(".hotel-saved-default").show();g.find(".search-saved-default").hide();g.find(".flight-saved-default").hide();}return setTimeout(function(){$(".user-history-tab").uitk_tooltip("hide");},5000);});},bindHeaderButtons:function(){var b=this;$(".optional-save-buttons .btn-action").click(function(c){c.stopPropagation();window.location="/user/login?&ckoflag=0&amp;amp;hsuc=&amp;amp;fram=&uurl=qscr%3Dredr%26rurl%3D%2Fscratchpad";});$(".optional-save-buttons .sub-action").click(function(c){c.stopPropagation();Scratchpad.declineSignInToSave();b.updateUI();});$(".optional-notes-buttons .btn-action").click(function(c){c.stopPropagation();b.showNotesEnrollmentHeader();Scratchpad.sendeVar28("SP.Tray.CS.OptIn").enrollInNudge();});$(".optional-notes-buttons .sub-action").click(function(c){c.stopPropagation();Scratchpad.declineNudge();b.updateUI();});$(".optional-deals-buttons .btn-action").click(function(c){c.stopPropagation();b.showDealsEnrollmentHeader(true);Scratchpad.sendeVar28("PD.Tray.CS.OptIn").enrollInNudge();});$(".optional-news-buttons .btn-action").click(function(c){c.stopPropagation();Scratchpad.sendeVar28("SP.Tray.CS.News");if(!Scratchpad.page){window.location.href="/scratchpad";}});},updateTrayHeader:function(){var b=Scratchpad.state.userPrompts,c="default";this.state.greeting=false;this.hideGreeting();return this;},showGreeting:function(){if(this.state.currentCount!==0){this.becomeTwoColumn();}this.$elements.$greeting.show();$(".scratchpad-item.first").removeClass("first");return this;},hideGreeting:function(){$(".user-history-tab .menu").removeClass("two-column");if(this.state.currentCount>0){this.$elements.$greeting.hide();$(".scratchpad-item").first().addClass("first");}else{this.showEmptyListState();}return this;},resetGreeting:function(){$(".scratchpad-greeting .greeting-message").hide();$(".scratchpad-greeting .greeting-submessage").hide();$(".optional-notes-buttons").hide().removeClass("active");$(".optional-save-buttons").hide().removeClass("active");$(".optional-news-buttons").hide().removeClass("active");$(".optional-deals-buttons").hide().removeClass("active");$(".greeting-icon").hide();return this;},showSaveHeader:function(){var b=this,c=this.locStrings.defaultHeaderMessage;$(".optional-save-buttons").show().addClass("active");$(".scratchpad-greeting .greeting-message").text(c).show();return{pass:true,result:[c]};},showNotesHeader:function(){var c=this,b=Scratchpad.trayTestAndLearns.getNudgeEnrollmentHeaderStrings(),d=b.title,e=b.subtitle,f=b.buttonText;$(".optional-notes-buttons").show().addClass("active");$(".scratchpad-greeting .greeting-message").html(d).show();$(".scratchpad-greeting .greeting-submessage").text(e).show();$(".optional-notes-buttons .btn-action").text(f);return{pass:true,result:[d]};},showNewsHeader:function(){if(window.AlertsMenu){AlertsMenu.tests.liveNudgeAlertTest.run();}else{this._showLegacyNewsHeader();}},_showLegacyNewsHeader:function(){var c=this,b=Scratchpad.trayTestAndLearns.getNewsHeaderStrings(),d=b.title,e=b.subtitle,f=b.buttonText;$(".greeting-icon").show();$(".scratchpad-greeting .greeting-message").text(d).show();$(".scratchpad-greeting .greeting-submessage").text(e).show();$(".optional-news-buttons .btn-action").text(f);$(".optional-news-buttons").show().addClass("active");},showDealsHeader:function(){var c=this,b=Scratchpad.trayTestAndLearns.getPrivateDealsHeaderStrings();$(".optional-deals-buttons").show().addClass("active");$(".optional-deals-buttons .sub-action").hide();$(".scratchpad-greeting .greeting-message").html(b.title).show();$(".scratchpad-greeting .greeting-submessage").text(b.subtitle).show();$(".optional-deals-buttons .btn-action").text(b.buttonText);return{pass:true,result:[b]};},showDefaultHeader:function(){var b=this.locStrings.thingsSavedHere;$(".scratchpad-greeting .greeting-message").text(b).show();return{pass:true,result:[b]};},showNotesEnrollmentHeader:function(){if(!this.state.greeting){this.showGreeting();}this.resetGreeting();$(".scratchpad-greeting .greeting-message").text(this.locStrings.notesConfirmation).show();},showDealsEnrollmentHeader:function(){$(".optional-deals-buttons").hide().removeClass("active");$(".scratchpad-greeting .greeting-message").text(Scratchpad.trayTestAndLearns.getPrivateDealsHeaderStrings().postActionState);if(Scratchpad.page){Scratchpad.page.setNotesToggle(true);}return{pass:true,result:[this.state.greeting]};},showEmptyListState:function(){var b=this.locStrings.thingsSavedHere;$(".scratchpad-greeting").show().find(".greeting-message").text(b).show();return this;},captureTemplates:function(){var c=this,d=true,b="success";if(!Scratchpad.state.legacyTemplates){Handlebars.registerHelper("viewership",function(e){var f=parseInt(e,10);if(f>1){return c.locStrings.others.replace("####",e);}else{if(f===1){return c.locStrings.other;}else{return"";}}});Handlebars.registerHelper("productDescription",function(e){var f=c.locStrings.included;if(e.length===2){f=f.replace("####",c.productNameMap[e[0]]).replace("####",c.productNameMap[e[1]]);}else{f="";}return f;});Handlebars.registerHelper("localizer",function(){var e="",f=[].splice.call(arguments,0,arguments.length-1),h=c.locStrings[f[0]],g=f.slice(1,f.length);if(h){e=c.localizer(h,g);}return e;});this.templates.hotelTemplate=Handlebars.templates["hotel-tray-item-template"];this.templates.hotelSearchTemplate=Handlebars.templates["hotel-search-tray-item-template"];this.templates.flightTemplate=Handlebars.templates["flight-tray-item-template"];this.templates.flightDetailTemplate=Handlebars.templates["flight-detail-tray-item-template"];this.templates.packageTemplate=Handlebars.templates["package-tray-item-template"];this.templates.carSearchTemplate=Handlebars.templates["car-search-tray-item-template"];this.templates.carDetailTemplate=Handlebars.templates["car-detail-tray-item-template"];this.templates.cruiseSearchTemplate=Handlebars.templates["cruise-search-tray-item-template"];this.templates.activitySearchTemplate=Handlebars.templates["activity-search-tray-item-template"];this.templates.activityDetailTemplate=Handlebars.templates["activity-detail-tray-item-template"];}else{this.templates.hotelTemplate=this.legacyHotelTemplate;
this.templates.hotelSearchTemplate=this.legacyHotelSearchTemplate;this.templates.flightTemplate=this.legacyFlightTemplate;this.templates.flightDetailTemplate=this.legacyFlightDetailTemplate;this.templates.packageTemplate=this.legacyPackageTemplate;this.templates.carSearchTemplate=this.legacyCarSearchTemplate;this.templates.carDetailTemplate=this.legacyCarDetailTemplate;this.templates.cruiseSearchTemplate=this.legacyCruiseSearchTemplate;this.templates.activitySearchTemplate=this.legacyActivitySearchTemplate;this.templates.activityDetailTemplate=this.legacyActivityDetailTemplate;}if(!this.templates.hotelTemplate||!this.templates.flightTemplate||!this.templates.hotelSearchTemplate||!this.templates.packageTemplate||!this.templates.carSearchTemplate||!this.templates.carDetailTemplate||!this.templates.cruiseSearchTemplate||!this.templates.activitySearchTemplate||!this.templates.activityDetailTemplate){d=false;b="not all templates assigned";}return{pass:d,result:[b]};},handleUserHistoryCheck:function(b,j){var d=Math.min(5,b.userHistory.length),c=(Scratchpad.trayTestAndLearns.state.requestLateHistory&&b.userHistory.length===1),g=b.userHistory[0],h,f;if(c){g.trayIndex=1;this.prependTrayItem(g);}else{for(var e=0;e<d;e++){h=b.userHistory[e];h.trayIndex=e+1;this.appendTrayItem(h);}}this.updateUI();},handleRegionViewershipResponse:function(e){var d;for(var c=0;c<e.hotelProductActivityAtRegionLevelList.length;c++){d=e.hotelProductActivityAtRegionLevelList[c];for(var b=0;b<this.trayItems.length;b++){if(this.trayItems[b].get("searchRegionId")===d.regionId){this.trayItems[b].set("viewCount",d.viewCount,true);}else{continue;}}}},handleHotelViewershipResponse:function(e){var b=[],f;for(var d=0;d<e.HotelProductActivityList.length;d++){f=e.HotelProductActivityList[d];for(var c=0;c<this.trayItems.length;c++){if(parseInt(this.trayItems[c].get("hotelId"),10)===f.HotelId){f.ViewCount=this.numberWithCommas(f.ViewCount);if(this.trayItems[c].get("hotelId")==f.HotelId){this.trayItems[c].set("viewCount",f.ViewCount,true);b.push(f);}}else{continue;}}}return{pass:true,result:b};},prependTrayItem:function(d){var b=this.removeMatchingTrayItem(d);if(!b){this.state.currentCount++;if(this.trayItems.length>=5){this.trayItems.pop().removeFromTray();}}var c=new Scratchpad.TrayItem(d);this.trayItems.unshift(c);c.insertBefore($(".user-history-tab .scratchpad-item").first());},appendTrayItem:function(c){this.removeMatchingTrayItem(c);var b=new Scratchpad.TrayItem(c);this.trayItems.push(b);$(".item-list").append(b.$el);},removeMatchingTrayItem:function(d){var e=0,c=this.trayItems.length,f={},b={"AIR":((d.type==="DETAIL")?"flightDetail":"flight"),"HOTEL":((d.type==="DETAIL")?"hotel":"hotelSearch"),"PACKAGE":"packages","CAR":((d.type==="DETAIL")?"carDetail":"carSearch")}[d.product];if(c>=1){for(e;e<c;e++){f=this.trayItems[e];if(f.type===b&&(f.get("id")===d[b]["id"])){this.trayItems.splice(e,1);f.removeFromTray();return true;}}}return false;},updateTrayFooter:function(){var c=[this.locStrings.viewAllItems.replace("####",this.state.currentCount),this.locStrings.viewScratchpad],b=(4-this.state.currentCount);$parent=this.$elements.$viewAllItem.parent().removeClass("pad-1 pad-2 pad-3 extra-padding");this.$elements.$viewAllItem.text(c[this.state.currentCount>5?0:1]);if(this.state.greeting&&b>0&&this.state.currentCount!==0){$parent.addClass("pad-"+b);}else{if(this.state.currentCount===0){this.$elements.$viewAllItem.parent().addClass("extra-padding");}}return{pass:true,result:[]};},legacyHotelTemplate:function(e){var b=Scratchpad.headerTray,d=parseInt(e.viewCount,10),f="";if(e.viewCount&&d===1){e.viewCount=b.locStrings.other;}else{if(e.viewCount&&d>1){e.viewCount=b.locStrings.others.replace("####",e.viewCount);}else{e.viewCount="";}}var c='<li class="scratchpad-item">'+'<a href="'+e.deepLinkUrl+'" class="item-link" data-onclick="">'+'<div class="item-data">'+'<span class="item-img-icon">'+'<img src="//images.trvl-media.com'+e.thumbnailUrl+'" alt="'+e.hotelName+'" class="image" aspectRatio="1-1">'+"</span>"+'<h4 class="item-title">'+e.hotelName+"</h4>"+'<p class="item-date">'+e.checkInDate+" - "+e.checkOutDate+"</p>"+'<p class="item-watches item-nested">'+e.viewCount+"</p>"+'<div class="item-price-urgency"><strong class="price">'+e.price+"</strong>"+'<p class="item-nested">'+e.lastSeenDate+"</p></div>"+"</div>"+"</a>"+"</li>";return c;},legacyHotelSearchTemplate:function(d){var b=Scratchpad.headerTray,f="",e="";if(d.viewCount){f=b.localizer(b.locStrings.othersSearching,[d.viewCount]);}if(d.amount){e='<div class="item-price-urgency"><strong class="price">'+d.price+"</strong>"+'<p class="item-package-message">'+b.localizer(b.locStrings.hotelSearchAvgPerNight)+"</p>"+'<p class="item-nested">'+b.localizer(b.locStrings.asOfDate,[d.lastSeenDate])+"</p></div>";}var c='<li class="scratchpad-item">'+'<a href="'+d.deepLinkUrl+'" class="item-link" data-onclick="">'+'<div class="item-data">'+'<span class="item-img-icon"><span class="icon icon-hotelsalt"></span></span>'+'<h4 class="item-title">'+b.localizer(b.locStrings.hotels,[d.destination])+"</h4>"+'<p class="item-date">'+b.localizer(b.locStrings.fromToHyphen,[d.checkInDate,d.checkOutDate])+"</p>"+e+'<p class="item-watches item-nested">'+f+"&nbsp;</p>"+"</div>"+"</a>"+"</li>";return c;},legacyFlightTemplate:function(c){var b='<li class="scratchpad-item">'+'<a href="'+c.deepLinkUrl+'" class="item-link" data-onclick="">'+'<div class="item-data">'+'<span class="item-img-icon">'+'<span class="icon icon-flightsalt"></span>'+"</span>"+'<h4 class="item-title">'+c.airportToAirport+"</h4>"+'<p class="item-date">'+c.departureDate+c.returnDate+"</p>"+'<p class="item-info item-nested">'+c.routeType+"</p>"+'<div class="item-price-urgency"><strong class="price">'+c.price+"</strong>"+'<p class="item-nested">'+c.lastSeen+"</p></div>"+"</div>"+"</a>"+"</li>";return b;},legacyActivitySearchTemplate:function(c){var b='<li class="scratchpad-item">'+'<a href="'+c.deepLinkUrl+'" class="item-link" data-onclick="">'+'<div class="item-data">'+'<span class="item-img-icon">'+'<span class="icon icon-activitiesalt"></span>'+"</span>"+'<h4 class="item-title">'+c.destination+"</h4>"+'<p class="item-date">'+c.startDate+" - "+c.endDate+"</p>"+'<div class="item-price-urgency"><strong class="price">'+c.price+"</strong>"+'<p class="item-nested">'+c.lastSeen+"</p></div>"+"</div>"+"</a>"+"</li>";return b;},legacyActivityDetailTemplate:function(c){var b='<li class="scratchpad-item">'+'<a href="'+c.deepLinkUrl+'" class="item-link" data-onclick="">'+'<div class="item-data">'+'<span class="item-img-icon">'+'<img src="'+c.thumbnailUrl+'" alt="'+c.title+'" class="image" aspectRatio="1-1">'+"</span>"+'<h4 class="item-title">'+c.title+"</h4>"+'<p class="item-date">'+c.startDate+"-"+c.endDate+"</p>"+'<div class="item-price-urgency"><strong class="price">'+c.price+"</strong>"+'<p class="item-nested">'+c.lastSeen+"</p></div>"+"</div>"+"</a>"+"</li>";return b;},legacyCruiseSearchTemplate:function(h){var c=Scratchpad.headerTray;var b=c.localizer(c.locStrings.asOfDate,[h.lastSeenDate]);var f=c.locStrings.cruises;var e='<li class="scratchpad-item">'+'<a href="'+h.deepLink+'" class="item-link" data-onclick="">'+'<div class="item-data">'+'<span class="item-img-icon">'+'<span class="icon icon-cruisealt"></span>'+"</span>"+'<h4 class="item-title">'+f+"</h4>";var d='<p class="item-date">'+h.pickupDate+" - "+h.dropOffDate+"</p>"+'<p class="item-dummy item-nested"></p>'+'<div class="item-price-urgency"><strong class="price">'+h.price+"</strong><div>"+c.locStrings.daily+"</div>"+'<p class="item-nested">'+b+"</p></div>"+"</div>"+"</a>"+"</li>";var g=e+d;return g;},legacyCarSearchTemplate:function(h){var e=Scratchpad.headerTray;var d=e.localizer(e.locStrings.asOfDate,[h.lastSeenDate]);var f="";if(h.pickupRegionType=="AIRPORT"){f=e.localizer(e.locStrings.carsAt,[h.pickupLocation]);}else{f=e.localizer(e.locStrings.carsNear,[h.pickupLocation]);}var c='<li class="scratchpad-item">'+'<a href="'+h.deepLink+'" class="item-link" data-onclick="">'+'<div class="item-data">'+'<span class="item-img-icon">'+'<span class="icon icon-carsalt"></span>'+"</span>"+'<h4 class="item-title">'+f+"</h4>";
var b='<p class="item-date">'+h.pickupDate+" - "+h.dropOffDate+"</p>"+'<p class="item-dummy item-nested"></p>'+'<div class="item-price-urgency"><strong class="price">'+h.price+"</strong><div>"+e.locStrings.daily+"</div>"+'<p class="item-nested">'+d+"</p></div>"+"</div>"+"</a>"+"</li>";var g=c+b;return g;},legacyCarDetailTemplate:function(g){var e=Scratchpad.headerTray;var d=e.localizer(e.locStrings.asOfDate,[g.lastSeenDate]);var c='<li class="scratchpad-item">'+'<a href="'+g.deepLink+'" class="item-link" data-onclick="">'+'<div class="item-data">'+'<span class="item-img-icon">'+'<img src="//images.trvl-media.com/cars'+g.thumbnailUrl+'" alt="'+g.carName+'" class="image" aspectRatio="1-1">'+"</span>"+'<h4 class="item-title">'+g.carName+"</h4>";var b='<p class="item-date">'+g.pickupDate+" - "+g.dropOffDate+"</p>"+'<p class="item-dummy item-nested">'+g.pickupLocation+"</p>"+'<div class="item-price-urgency"><strong class="price">'+g.price+"</strong><div>"+e.locStrings.daily+"</div>"+'<p class="item-nested">'+d+"</p></div>"+"</div>"+"</a>"+"</li>";var f=c+b;return f;},legacyFlightDetailTemplate:function(g){var o=Scratchpad.headerTray,j="",p="",f=g.legs.length,h;for(h=0;h<f;h++){var n=g.legs[h],e="",m="//images.trvl-media.com/media/content/expus/graphics/static_content/fusion/v0.1b/images/airlines/s/",c="multiple_airlines_logo",k=o.locStrings.multipleAirlinesLogoAltText,b=o.locStrings.fromTo.replace("####",n.departureAirportCode).replace("####",n.arrivalAirportCode),l=o.locStrings.fromToHyphen.replace("####",n.departureTime).replace("####",n.arrivalTime),d="";if(h>0){d=" item-group-gap";}if(n.numberOfDays){e=' <span class="number-of-days">+'+n.numberOfDays+"</span>";}if(n.airlineImageFileName){c=n.airlineImageFileName;k=n.airlineName+o.locStrings.airlineLogoAltText;}m=m+c+"_sq.jpg";p=p+'<span class="item-img-icon'+d+'">'+'<img src="'+m+'" alt="'+k+'" class="image" aspectRatio="1-1">'+"</span>"+'<h4 class="item-title'+d+'">'+b+"</h4>"+'<p class="item-date">'+'<span class="departure-date">'+n.departureDate+"</span><!--"+'--><span class="time-range">'+l+"</span>"+e+"</p>";}j='<li class="scratchpad-item flight-detail">'+'<a href="'+g.deepLinkUrl+'" class="item-link" data-onclick="">'+'<div class="item-data">'+p+'<div class="item-price-urgency"><strong class="price">'+g.formattedPricePerPerson+"</strong>"+'<p class="item-nested">'+g.lastSeen+"</p></div>"+"</div>"+"</a>"+"</li>";return j;},legacyPackageTemplate:function(f){var c=Scratchpad.headerTray,b=c.locStrings.included,d=c.locStrings.packages.replace("####",f.packageDestination);if(f.products.length===2){b=b.replace("####",c.productNameMap[f.products[0]]).replace("####",c.productNameMap[f.products[1]]);}else{b="";}var e='<li class="scratchpad-item">'+'<a href="'+f.deepLinkUrl+'" class="item-link" data-onclick="">'+'<div class="item-data">'+'<span class="item-img-icon">'+'<span class="icon icon-packagesalt"></span>'+"</span>"+'<h4 class="item-title">'+d+"</h4>"+'<p class="item-date item-nested">'+f.departureDate+f.returnDate+"</p>"+'<p class="item-info item-nested">'+b+"</p>"+'<div class="item-price-urgency"><strong class="price">'+f.price+"</strong>"+'<p class="item-package-message">'+c.locStrings.perPerson+f.lastSeen+"</p></div>"+'<span class="item-img-icon">'+"</span>"+"</div>"+"</a>"+"</li>";return e;},numberWithCommas:function(b){var c=b.toString().split(".");c[0]=c[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");return c.join(".");},localizer:function(e,b){var c=e||"";if(b){for(var d=0;d<b.length;d++){c=c.replace("####",b[d]);}}return c;}};})(Scratchpad);var Scratchpad=Scratchpad||{};(function(a){a.trayTestAndLearns={state:{currentCount:0,isMobileHeader:false,requestLateHistory:false,doublewideTrayBucket:0,inCSMVPTest:false},buckets:{4077:-1,4939:-1,6051:-1},init:function(d,c){var b=this;this.buckets[4077]=parseInt(window.scratchpadBadgeFlareTLFlag,10);this.buckets[4939]=parseInt(window.scratchpad2ColTrayTestBucket,10);this.buckets[6051]=parseInt(window.scratchpadUseLiveAlertsAsNews,10);this.state.isMobileHeader=($(window).width()<711);this.state.inCSMVPTest=(this.buckets[4939]>0);if(this.buckets[4077]===1){setTimeout(function(){b.badgeFlareTL();},2000);}},badgeFlareTL:function(){if(!this.state.currentCount>0||$("#scratchpad-badge").hasClass("visuallyhidden")){return;}var e=8,d=8,c=-4,b=-4;if(this.state.currentCount>9){e+=4;c=c+3;}$(".scratchpad-flare").css({"opacity":"1","margin-left":e+"px","margin-top":"8px"}).animate({"width":"30px","height":"30px","margin-left":(c-3)+"px","margin-top":"-7px","opacity":"0"},1000).delay(1).animate({"width":"0","height":"0","margin-left":e+"px","margin-top":"8px"}).delay(1).animate({"opacity":"1"});return{pass:true,result:[]};},searchTooltipTL:function(c){if(window.uitk){var l=Scratchpad.state.userIsNudgeEnrolled,m=$(".user-history-tab"),b=(!l&&m.attr("data-tt-color")==="blue")?"isBlue":"",n=(Scratchpad.state.isTVLY)?"isTVLY":"",g=(Scratchpad.state.isWotif)?"isWotif":"",i=(Scratchpad.state.isLastMinute)?"isLastMinute":"",o=(Scratchpad.state.isOrbitz)?"isOrbitz":"",h=(Scratchpad.state.isCheapTickets)?"isCheapTickets":"",f=(Scratchpad.state.isEbookers)?"isEbookers":"",d=(Scratchpad.state.isHotwire)?"isHotwire":"",k=(Scratchpad.state.isAago)?"isAago":"",e=(Scratchpad.state.isMrJet)?"isMrJet":"",j=(l)?".search-saved-default":".search-saved-cta";if(Scratchpad.state.isTVLY){j=".search-saved";}setTimeout(function(){if(Scratchpad.headerTray.state.alreadyShowedTT){return;}Scratchpad.headerTray.state.alreadyShowedTT=true;var p=$(".user-history-tab").attr("data-content");$(".user-history-tab").attr("data-content","");$(".user-history-tab").uitk_tooltip("show");var q=$(".theme-urgency");q.find(".tooltip-inner").html(p);$(".search-saved-cta").after($(".user-history-tab").attr("nudge-data"));var q=$(".theme-urgency");if(Scratchpad.state.isTVLY){q.find($(".hotel-saved").hide());q.find($(".flight-saved").hide());}if(Scratchpad.state.pageId==="car-search"){Scratchpad.sendeVar28("CARS.ScratchpadTooltip.Shown");}q.css({"opacity":0}).find(j).show().closest(".theme-urgency").addClass(n+" "+b+" "+g+" "+i+" "+h+" "+o+" "+f+" "+k+" "+e).animate({"opacity":"1"},200).delay(4500).animate({"opacity":"0"},200,function(){$(this).hide();});q.find(".sp-enrollment-tt-cta").click(function(){Scratchpad.sendeVar28("SP.FSRTooltip.CTA").enrollInNudge();if(Scratchpad.state.loggedInUser){q.find(j).hide();q.find(".enroll-success").show();uitk.utils.liveAnnounce(q.find(".enroll-success").text(),"polite");}});uitk.publish("Scratchpad.FSRTooltip.Shown",q);},2500);}return{pass:true,result:[]};},flightTooltipTL:function(c){if(window.uitk){var k=Scratchpad.state.userIsNudgeEnrolled,l=$(".user-history-tab"),b=(!k&&l.attr("data-tt-color")==="blue")?"isBlue":"",m=(Scratchpad.state.isTVLY)?"isTVLY":"",f=(Scratchpad.state.isWotif)?"isWotif":"",h=(Scratchpad.state.isLastMinute)?"isLastMinute":"",n=(Scratchpad.state.isOrbitz)?"isOrbitz":"",g=(Scratchpad.state.isCheapTickets)?"isCheapTickets":"",e=(Scratchpad.state.isEbookers)?"isEbookers":"",j=(Scratchpad.state.isAago)?"isAago":"",d=(Scratchpad.state.isMrJet)?"isMrJet":"",i=(k)?".flight-saved-default":".flight-saved-cta";if(Scratchpad.state.isTVLY){i=".flight-saved";}setTimeout(function(){if(Scratchpad.headerTray.state.alreadyShowedTT){return;}Scratchpad.headerTray.state.alreadyShowedTT=true;var o=$(".user-history-tab").attr("data-content");$(".user-history-tab").attr("data-content","");$(".user-history-tab").uitk_tooltip("show");var p=$(".theme-urgency");p.find(".tooltip-inner").html(o);$(".flight-saved-cta").after($(".user-history-tab").attr("nudge-data"));if(Scratchpad.state.isTVLY){p.find($(".hotel-saved").hide());p.find($(".search-saved").hide());}p.css({"opacity":0}).find(i).show().closest(".theme-urgency").addClass(m+" "+b+" "+f+" "+h+" "+g+" "+n+" "+e+" "+d).animate({"opacity":"1"},200).delay(4500).animate({"opacity":"0"},200,function(){$(this).hide();});p.find(".sp-enrollment-tt-cta").click(function(){Scratchpad.sendeVar28("SP.UDPTooltip.CTA").enrollInNudge();if(Scratchpad.state.loggedInUser){p.find(i).hide();
p.find(".enroll-success").show();uitk.utils.liveAnnounce(p.find(".enroll-success").text(),"polite");}});},2500);}return{pass:true,result:[]};},lateAddItemTL:function(e){var d=this;if(e==="Flight-Search"){this.state.requestLateHistory=true;uitk.subscribe("Flights.ModuleBuilder.Controller.renderComplete",function(){d.getMostRecent(1);});}else{if(e==="Package-Search"){this.state.requestLateHistory=true;var g=0;var b=setInterval(function(){g+=500;if(window.rendered&&window.totalResultsCount&&window.totalResultsCount>0){clearInterval(b);d.getMostRecent(1);}else{if(g>10000){clearInterval(b);}}},500);}else{if(e==="Hotels-Infosite"){this.state.requestLateHistory=true;this.getMostRecent(1);}else{if(e==="car-search"){this.state.requestLateHistory=true;uitk.subscribe("CARS.Search.Complete",function(){Scratchpad.headerTray.state.alreadyShowedTT=false;d.getMostRecent(1);});}else{var c=[];for(var f=0;f<c.length;f++){if(c[f]===e){this.state.requestLateHistory=true;this.getMostRecent(1);}}}}}}},getMostRecent:function(c){var b=this;c=c||1;setTimeout(function(){Scratchpad.getHistoryData(c,true);$(".scratchpad-greeting").hide();},1000);},getNudgeEnrollmentHeaderStrings:function(){return{title:"Get price and availability changes for hotels you view.",subtitle:"Your Scratchpad can watch for updates 24/7.",buttonText:"Track Changes"};},getNewsHeaderStrings:function(){return{title:"Something's changed!",subtitle:"Your Scratchpad found an update for at least one hotel you viewed.",buttonText:"See What's Changed"};},getPrivateDealsHeaderStrings:function(){return{title:["Get price and availability changes for hotels you view.","Unlock private deals on hotels you view.","Never miss another deal!"][this.buckets[4939]],subtitle:["Your Scratchpad can watch for updates 24/7.","Your Scratchpad can watch for exclusive savings 24/7.","Track hotels you view for deals, price and availability updates."][this.buckets[4939]],buttonText:["Track Changes","Unlock Private Deals","Keep Me Updated"][this.buckets[4939]],postActionState:"Nice! Watch your inbox for deal alerts from your Scratchpad."};}};})(Scratchpad);
/*!  generated on 2016-09-02 17:05:57.988 UTC(+0000) in 10719 ms  */

/*!  served in 3 ms  */
