var airattach=airattach||{};airattach.init=function(){airattach.hotelIds=[];$.ajax({dataType:"json",url:"/api/airattach/qualification",success:airattach.callback,cache:false,timeout:5000});};airattach.callback=function(b){if(b&&b.qualificationWindows&&b.qualificationWindows.length>0){var a=b.qualificationWindows[0];var d=a.tripInfo.finalDestinationAirportCode;var c=$(".air-attach-container");airattach.setAirattachData(a);airattach.renderCountdown();airattach.setSearchUrlAndCityName(c,d);c.removeClass("hidden");}};airattach.setAirattachData=function(a){airattach.timer=a.timeLeftForExpirationInMilliSecs/1000;airattach.startDate=new XDate(new Date(a.startDate)).toString(corewizard.conf.def.dateFormat);airattach.endDate=new XDate(new Date(a.endDate)).toString(corewizard.conf.def.dateFormat);airattach.origin=a.tripInfo.originAirportCode;airattach.tripType=a.tripInfo.tripType;airattach.enableOfferWindowTillTravel=a.enableOfferWindowTillTravel;};airattach.renderCountdown=function(){var i,e,b,f;var h=$(".offer-countdown-timer"),c=$(".offer-countdown");if(airattach.enableOfferWindowTillTravel){i=Math.ceil(airattach.timer/86400);}else{i=Math.floor(airattach.timer/86400);}if(i>=3){var g=$(c).attr("data-days");var a=(g&&g.indexOf("X")>-1)?g.replace("X",i):i+" days";$(h).html(a);$(c).addClass("timer-ready");}else{var d=$(".offer-countdown-timer").html();setInterval(function(){var k=airattach.timer--;e=parseInt(k/3600);k=k%3600;b=parseInt(k/60);f=parseInt(k%60);if(e<10){e="0"+e;}if(b<10){b="0"+b;}if(f<10){f="0"+f;}var j=d.replace("hh",e).replace("mm",b).replace("ss",f);$(h).html(j);$(c).addClass("timer-ready");},1000);}};airattach.setSearchUrlAndCityName=function(a,c){var b=a.find(".airattach-trip-cityname");airattach.getDataFromAirportTla(c,function(d){airattach.regionId=d.sr[0].amc;airattach.cityname=d.sr[0].d.split(",")[0];var e={regionId:airattach.regionId,rooms:[{adults:1}],startDate:(airattach.tripType=="ROUND_TRIP")?airattach.startDate:"",endDate:(airattach.tripType=="ROUND_TRIP")?airattach.endDate:""};airattach.hotelSearchUrl=corewizard.search.hotelSearchUrl(e);a.children("a").attr("href",airattach.hotelSearchUrl);b.html(airattach.cityname);});};airattach.hotmipDealsCallback=function(a){if(a&&a.hotelModels&&a.totalResultsCount>0){airattach.hotels=[];$.each(a.hotelModels,function(b,c){if(b>2){return false;}airattach.addHotel(c);});if(airattach.hotels.length==3){airattach.renderHotels();}else{airattach.getRecommendedHotels();}}};airattach.addHotel=function(a){var b={};b.name=decodeURIComponent(a.hotelName);b.stars=a.starRating.replace(".","-");b.price="$"+Math.round(a.averagePriceValue);b.dates=recentlyViewed.formatDatePair(airattach.startDate,airattach.endDate);b.img=a.urlToThumbnail;b.url=a.urlToHotelInfosite;airattach.hotels.push(b);airattach.hotelIds.push(a.hotelId);};airattach.getRecommendedHotels=function(){var a="/Hotel-Recommender-Ajax?action=getProductRecommendations&scenario=homepage&rule=persona-region-item-xsell&maxCount=5&getDetails=true&itemType=1&itemId=";a+=airattach.regionId+"&";a+="startDate="+airattach.startDate+"&";a+="endDate="+airattach.endDate+"&";a+="travellersInfo=1";$.ajax({dataType:"json",url:a,success:airattach.recommendedHotelsCallback,cache:false,timeout:5000});};airattach.recommendedHotelsCallback=function(a){if(a&&a.hotelModels&&a.totalResultsCount>0){$.each(a.hotelModels,function(b,c){if(b>2||airattach.hotels.length==3){return false;}if($.inArray(c.hotelId,airattach.hotelIds)!=-1){return true;}airattach.addHotel(c);});if(airattach.hotels.length==3){airattach.renderHotels();}}};airattach.renderHotels=function(){var b={hotels:airattach.hotels,hotelSearchUrl:airattach.hotelSearchUrl};var c=Handlebars.partials["handlebars/airattach/hotels-container"];var a=c(b);$(".air-attach-hotel-tiles").html(a).removeClass("hidden");};airattach.getDataFromAirportTla=function(a,b){$.ajax({dataType:"jsonp",url:"https://suggest.expedia.com/hint/es/v2/sri/en_US/"+a+"?lob=packages",success:b,cache:false,timeout:5000});};airattach.init();
/*!  generated on 2016-09-02 09:09:10.815 PDT(-0700) in 6 ms  */

/*!  served in 1 ms  */
