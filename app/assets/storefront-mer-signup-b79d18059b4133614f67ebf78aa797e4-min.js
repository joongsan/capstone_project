define("loyalty.record.corewizard.mer.signup",["jquery","handlebars","uitk","experimentRecorder"],function(a,m,n,p){function h(c){c="//www.expedia-email.com/OptIn/DefaultE.aspx?email_addr\x3d"+c+"\x26TPID\x3d"+window.tpid+"\x26EAPID\x3d"+window.eapid+"\x26LANG_ID\x3d"+corewizard.conf.def.model.lang+"\x26P/CREATE_DATE\x3d"+(new Date).getTime()+"\x26P/H_AIRPORT_CODE\x3d999\x26source_code\x3dPriceAlerts";a.ajax({type:"POST",url:c,dataType:"html"});corewizard.core.state.set("merSignupSuccess",!0);corewizard.core.state.set("merSignupState","open");e()}function q(c){a.ajax({type:"POST",url:"/create-soft-account",dataType:"json",data:{email:c,channelType:"SFMODSignUp"},success:function(a){1==a.newSoftAccountCreated&&r.trackEvent("o","Soft Account signup through MOD modal on Storefront",{eVar28:"HP:MemberDealsBanner:SignUp",prop16:"HP:MemberDealsBanner:SignUp"},"event139")}})}function s(c,b){"hotel"!==b||corewizard.masterconfig.user.isIdentified||corewizard.masterconfig.user.isAuthenticated?a("#mer-signup-wrapper").addClass("hidden"):a("#mer-signup-wrapper").removeClass("hidden");g||k(b)}function k(a){g?e():"hotel"!==a||corewizard.masterconfig.user.isIdentified||corewizard.masterconfig.user.isAuthenticated||(p.evaluateAndRecord(11424,["guestUserRequired"],t),g=!0)}function t(a){0<a.bucketValue&&(l=corewizard.loc.merSignup["merSignupTitleVariant"+a.bucketValue]);e()}function e(){var c=m.partials["handlebars/wizard/mer-signup"],b=corewizard.core.state.get("merSignupState"),b=b?b:"closed",b={merSignupToggleState:b,isToggleClosed:"closed"==b,isMerSuccess:corewizard.core.state.get("merSignupSuccess"),merVisibility:"hotel"!==corewizard.core.getLob()?"hidden":"",merSignupTitle:l};b.isMerSuccess&&(b.merSignupTitle=corewizard.loc.merSignup.merSignupSuccessTitle);c=c(b);a("#mer-signup-container").html(c);a("#mer-signup-toggle").on("click",function(d){d=a("#mer-signup-wrapper").find(".toggle-trigger");a(d).uitk_toggle("toggle")}).on("click","#mer-email-label, #mer-signup-button",function(a){a.stopPropagation()});a("#mer-signup-button").on("click",function(d){d.preventDefault();var b=a("#mer-email"),c=b.parent("label");d=a("#"+b.attr("aria-describedby"));var f="email"===b.attr("type")?!0:!1,e;(e=""===b.val())||(f&&(f=b.val(),f=!/^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i.test(f)),e=f);e?(c.addClass("invalid"),b.attr("aria-invalid","true"),b=b.data("validationMsg"),d.html(b).removeClass("hidden"),d=!1):(c.removeClass("invalid"),b.attr("aria-invalid","false"),d.html("").addClass("hidden"),d=!0);d&&("1"==u&&q(a("#mer-email").val()),h(a("#mer-email").val()))});a("#mer-email").on("keydown",function(a){13==a.keyCode&&a.preventDefault()});a("#mer-email").on("keyup",function(b){13==b.keyCode&&(b.preventDefault(),a("#mer-signup-button").click())})}var g,l=corewizard.loc.merSignup.merSignupTitleControl,u=corewizard.masterconfig.abacus["11531"],r=window.dctk;return{init:function(){n.subscribe("corewizard.tabsReloaded",s);k(corewizard.core.getLob())},submitMEREmail:h}});
//# sourceMappingURL=storefront-mer-signup.js.map